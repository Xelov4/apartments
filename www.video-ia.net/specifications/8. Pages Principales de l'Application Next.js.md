# Pages Principales de l'Application Next.js

Cette section présente les implémentations détaillées des principales pages de l'application Video-IA avec Next.js, Shadcn UI et Tailwind CSS.

## 1. Page de détail d'un outil (app/tools/[slug]/page.js)

```jsx
import { notFound } from 'next/navigation'
import Image from 'next/image'
import Link from 'next/link'
import { getToolBySlug } from '@/lib/actions/tools'
import { formatDate } from '@/lib/utils/formatting'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Card, CardContent } from '@/components/ui/card'
import { Separator } from '@/components/ui/separator'
import {
  ExternalLink,
  Star,
  ThumbsUp,
  Calendar,
  MessageSquare,
  Share2,
  Globe,
  Tag,
  Check,
  ArrowLeft
} from 'lucide-react'
import RatingStars from '@/components/modules/RatingStars'
import ReviewForm from '@/components/modules/ReviewForm'
import ToolCard from '@/components/modules/ToolCard'

// Métadonnées dynamiques pour SEO
export async function generateMetadata({ params }) {
  const tool = await getToolBySlug(params.slug)
  
  if (!tool) {
    return {
      title: 'Outil non trouvé | Video-IA',
      description: 'L\'outil demandé n\'a pas été trouvé dans notre annuaire.'
    }
  }
  
  return {
    title: `${tool.name} | Video-IA`,
    description: tool.short_desc,
    openGraph: {
      title: `${tool.name} | Video-IA`,
      description: tool.short_desc,
      images: [
        {
          url: tool.logo_url || '/images/default-tool.jpg',
          width: 1200,
          height: 630,
          alt: tool.name
        }
      ]
    }
  }
}

export default async function ToolDetailPage({ params }) {
  const tool = await getToolBySlug(params.slug)
  
  if (!tool) {
    notFound()
  }
  
  // Extraction des données
  const { name, website, description, short_desc, logo_url, category, tags, reviews, rating, similarTools } = tool
  
  // Conversion des features de JSON à objets
  const features = tool.features ? (
    Array.isArray(tool.features) ? tool.features : JSON.parse(tool.features)
  ) : []
  
  // Détermination du badge de prix
  const priceBadgeVariant = 
    tool.pricing_type === 'free' ? 'success' : 
    tool.pricing_type === 'freemium' ? 'warning' : 
    'default'
  
  const priceBadgeText = 
    tool.pricing_type === 'free' ? 'Gratuit' : 
    tool.pricing_type === 'freemium' ? 'Freemium' : 
    tool.pricing_type === 'trial' ? 'Essai gratuit' : 'Payant'
  
  return (
    <div className="container py-8">
      {/* Breadcrumbs navigation */}
      <div className="flex items-center text-sm text-muted-foreground mb-6">
        <Link href="/" className="hover:text-primary">Accueil</Link>
        <span className="mx-2">/</span>
        <Link href="/categories" className="hover:text-primary">Catégories</Link>
        <span className="mx-2">/</span>
        <Link href={`/categories/${category.slug}`} className="hover:text-primary">
          {category.name}
        </Link>
        <span className="mx-2">/</span>
        <span className="font-medium text-foreground">{name}</span>
      </div>
      
      {/* Back button */}
      <Button variant="ghost" size="sm" asChild className="mb-6">
        <Link href={`/categories/${category.slug}`}>
          <ArrowLeft className="mr-2 h-4 w-4" />
          Retour à {category.name}
        </Link>
      </Button>
      
      {/* Tool header card */}
      <Card className="mb-8">
        <CardContent className="p-6">
          <div className="flex flex-col md:flex-row gap-6">
            {/* Logo */}
            <div className="w-full md:w-48 flex-shrink-0">
              <div className="relative w-full aspect-square rounded-lg overflow-hidden border">
                {logo_url ? (
                  <Image 
                    src={logo_url} 
                    alt={name} 
                    fill 
                    className="object-cover" 
                    sizes="(max-width: 768px) 100vw, 192px" 
                    priority
                  />
                ) : (
                  <div className="w-full h-full flex items-center justify-center bg-gray-100">
                    <span className="text-4xl font-bold text-gray-300">
                      {name.charAt(0)}
                    </span>
                  </div>
                )}
              </div>
            </div>
            
            {/* Tool basic info */}
            <div className="flex-grow">
              <div className="flex flex-col md:flex-row justify-between gap-4">
                <div>
                  <h1 className="text-3xl font-bold">{name}</h1>
                  <p className="text-lg text-muted-foreground mt-1 mb-3">{short_desc}</p>
                  
                  <div className="flex flex-wrap gap-2 mb-4">
                    <Badge variant={priceBadgeVariant}>
                      {priceBadgeText}
                    </Badge>
                    <Badge variant="outline">
                      <Tag className="h-3 w-3 mr-1" />
                      {category.name}
                    </Badge>
                    {tags.slice(0, 3).map(tag => (
                      <Badge key={tag.id} variant="secondary" className="text-xs">
                        {tag.name}
                      </Badge>
                    ))}
                    {tags.length > 3 && (
                      <Badge variant="outline" className="text-xs">
                        +{tags.length - 3}
                      </Badge>
                    )}
                  </div>
                </div>
                
                <div className="flex flex-col gap-3">
                  <Button className="w-full" size="lg" asChild>
                    <a href={website} target="_blank" rel="noopener noreferrer">
                      <Globe className="mr-2 h-4 w-4" />
                      Visiter le site
                    </a>
                  </Button>
                  <Button variant="outline" className="w-full" asChild>
                    <a href="#reviews">
                      <MessageSquare className="mr-2 h-4 w-4" />
                      Ajouter un avis
                    </a>
                  </Button>
                </div>
              </div>
              
              {/* Ratings */}
              <div className="flex items-center mt-4">
                <RatingStars rating={rating} size="lg" />
                <span className="ml-2 font-medium">
                  {rating.toFixed(1)}
                </span>
                <span className="ml-2 text-muted-foreground">
                  ({reviews.length} avis)
                </span>
              </div>
              
              {/* Quick stats */}
              <div className="grid grid-cols-2 md:grid-cols-4 gap-4 mt-6">
                <div className="flex flex-col items-center p-3 bg-muted/50 rounded-lg">
                  <Calendar className="h-5 w-5 text-muted-foreground mb-1" />
                  <span className="text-xs text-muted-foreground">Ajouté le</span>
                  <span className="font-medium">{formatDate(tool.created_at)}</span>
                </div>
                <div className="flex flex-col items-center p-3 bg-muted/50 rounded-lg">
                  <ThumbsUp className="h-5 w-5 text-muted-foreground mb-1" />
                  <span className="text-xs text-muted-foreground">Recommandé par</span>
                  <span className="font-medium">
                    {reviews.filter(r => r.rating >= 4).length} utilisateurs
                  </span>
                </div>
                <div className="flex flex-col items-center p-3 bg-muted/50 rounded-lg">
                  <Star className="h-5 w-5 text-muted-foreground mb-1" />
                  <span className="text-xs text-muted-foreground">Note maximale</span>
                  <span className="font-medium">
                    {reviews.length > 0 ? `${Math.max(...reviews.map(r => r.rating))}/5` : "N/A"}
                  </span>
                </div>
                <div className="flex flex-col items-center p-3 bg-muted/50 rounded-lg">
                  <ExternalLink className="h-5 w-5 text-muted-foreground mb-1" />
                  <span className="text-xs text-muted-foreground">Type</span>
                  <span className="font-medium">
                    {tags.find(t => t.name === "Web-Based") ? "Web" : "Application"}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </CardContent>
      </Card>
      
      {/* Detailed content with tabs */}
      <Tabs defaultValue="description" className="mb-12">
        <TabsList className="mb-6">
          <TabsTrigger value="description">Description</TabsTrigger>
          <TabsTrigger value="features">Fonctionnalités</TabsTrigger>
          <TabsTrigger value="pricing">Tarification</TabsTrigger>
          <TabsTrigger value="reviews">Avis ({reviews.length})</TabsTrigger>
        </TabsList>
        
        {/* Description tab */}
        <TabsContent value="description" className="mt-0">
          <div className="prose prose-lg max-w-none dark:prose-invert">
            <div className="mb-8" dangerouslySetInnerHTML={{ __html: description }} />
            
            <div className="mt-12">
              <h3 className="text-2xl font-semibold mb-4">Tags</h3>
              <div className="flex flex-wrap gap-2">
                {tags.map(tag => (
                  <Badge key={tag.id} variant="outline" className="text-sm">
                    {tag.name}
                  </Badge>
                ))}
              </div>
            </div>
          </div>
        </TabsContent>
        
        {/* Features tab */}
        <TabsContent value="features" className="mt-0">
          <div className="grid gap-6 md:grid-cols-2">
            {features.map((feature, index) => (
              <Card key={index}>
                <CardContent className="p-6">
                  <div className="flex gap-4">
                    <div className="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center flex-shrink-0">
                      <Check className="h-5 w-5 text-primary" />
                    </div>
                    <div>
                      <h3 className="font-semibold text-lg mb-2">{feature.title}</h3>
                      <p className="text-muted-foreground">{feature.description}</p>
                    </div>
                  </div>
                </CardContent>
              </Card>
            ))}
            
            {features.length === 0 && (
              <div className="col-span-2 text-center py-12 text-muted-foreground">
                Aucune fonctionnalité détaillée disponible pour cet outil.
              </div>
            )}
          </div>
        </TabsContent>
        
        {/* Pricing tab */}
        <TabsContent value="pricing" className="mt-0">
          <Card>
            <CardContent className="p-6">
              <h3 className="text-2xl font-semibold mb-4">Informations de tarification</h3>
              <Badge className="mb-4" variant={priceBadgeVariant}>
                {priceBadgeText}
              </Badge>
              
              {tool.pricing_details ? (
                <div className="prose max-w-none dark:prose-invert" 
                     dangerouslySetInnerHTML={{ __html: tool.pricing_details }} />
              ) : (
                <div className="text-muted-foreground">
                  {tool.pricing_type === 'free' ? (
                    <p>Cet outil est entièrement gratuit à utiliser.</p>
                  ) : tool.pricing_type === 'freemium' ? (
                    <p>Cet outil propose une version gratuite avec des fonctionnalités limitées et des plans premium payants pour accéder à toutes les fonctionnalités.</p>
                  ) : tool.pricing_type === 'trial' ? (
                    <p>Cet outil propose un essai gratuit limité dans le temps avant de passer à un modèle payant.</p>
                  ) : (
                    <p>Cet outil est payant. Consultez le site officiel pour connaître les détails de tarification à jour.</p>
                  )}
                  
                  <div className="mt-4">
                    <a 
                      href={website} 
                      target="_blank" 
                      rel="noopener noreferrer"
                      className="text-primary hover:underline flex items-center"
                    >
                      Voir la tarification sur le site officiel
                      <ExternalLink className="ml-2 h-4 w-4" />
                    </a>
                  </div>
                </div>
              )}
            </CardContent>
          </Card>
        </TabsContent>
        
        {/* Reviews tab */}
        <TabsContent value="reviews" className="mt-0">
          <div className="mb-8">
            <h3 className="text-2xl font-semibold mb-4">Avis des utilisateurs</h3>
            
            {reviews.length > 0 ? (
              <div className="space-y-6">
                {reviews.map((review) => (
                  <Card key={review.id}>
                    <CardContent className="p-6">
                      <div className="flex justify-between items-start">
                        <div className="flex items-center">
                          <div className="w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center mr-4">
                            <span className="font-semibold">
                              {review.user_name.charAt(0).toUpperCase()}
                            </span>
                          </div>
                          <div>
                            <p className="font-semibold">{review.user_name}</p>
                            <p className="text-sm text-muted-foreground">
                              {formatDate(review.created_at)}
                            </p>
                          </div>
                        </div>
                        <RatingStars rating={review.rating} />
                      </div>
                      <p className="mt-4">{review.comment}</p>
                    </CardContent>
                  </Card>
                ))}
              </div>
            ) : (
              <Card>
                <CardContent className="p-6 text-center">
                  <p className="text-muted-foreground">
                    Aucun avis pour cet outil. Soyez le premier à donner votre opinion !
                  </p>
                </CardContent>
              </Card>
            )}
          </div>
          
          {/* Review form */}
          <div id="reviews">
            <h3 className="text-2xl font-semibold mb-4">Ajouter un avis</h3>
            <Card>
              <CardContent className="p-6">
                <ReviewForm toolId={tool.id} />
              </CardContent>
            </Card>
          </div>
        </TabsContent>
      </Tabs>
      
      {/* Similar tools section */}
      {similarTools.length > 0 && (
        <div className="mt-16">
          <div className="flex justify-between items-center mb-6">
            <h2 className="text-2xl font-bold">Outils similaires</h2>
            <Button variant="outline" asChild>
              <Link href={`/categories/${category.slug}`}>
                Voir plus
                <ArrowRight className="ml-2 h-4 w-4" />
              </Link>
            </Button>
          </div>
          
          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            {similarTools.map((tool) => (
              <ToolCard key={tool.id} tool={tool} />
            ))}
          </div>
        </div>
      )}
    </div>
  )
}
```

## 2. Page de recherche (app/search/page.js)

```jsx
import { Suspense } from 'react'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Card, CardContent, CardDescription, CardHeader, CardTitle } from '@/components/ui/card'
import { Input } from '@/components/ui/input'
import { Button } from '@/components/ui/button'
import { Badge } from '@/components/ui/badge'
import { Separator } from '@/components/ui/separator'
import { Search as SearchIcon, SlidersHorizontal, Grid, List, X } from 'lucide-react'
import ToolCard from '@/components/modules/ToolCard'
import ToolListItem from '@/components/modules/ToolListItem'
import FilterPanel from '@/components/modules/FilterPanel'
import FilterDrawer from '@/components/modules/FilterDrawer' 
import SearchSkeleton from '@/components/skeletons/SearchSkeleton'
import { searchTools } from '@/lib/actions/tools'
import { getAllTags } from '@/lib/actions/tags'
import { getAllCategories } from '@/lib/actions/categories'

export const metadata = {
  title: 'Recherche d\'outils IA pour la vidéo | Video-IA',
  description: 'Recherchez parmi notre catalogue complet d\'outils d\'intelligence artificielle dédiés à la vidéo.'
}

// Recherche côté serveur avec paramètres d'URL
async function SearchResults({ 
  query, 
  categoryId, 
  tags, 
  pricingType, 
  sort = 'relevance',
  view = 'grid',
  page = 1 
}) {
  // Conversion des paramètres
  const tagsArray = tags ? (Array.isArray(tags) ? tags : [tags]) : []
  const pageNumber = parseInt(page) || 1
  
  // Recherche avec tous les filtres
  const { tools, pagination } = await searchTools({
    query,
    categoryId: categoryId ? parseInt(categoryId) : null,
    tags: tagsArray.map(tag => parseInt(tag)),
    pricingType,
    sort,
    page: pageNumber
  })
  
  if (tools.length === 0) {
    return (
      <div className="text-center py-16">
        <h3 className="text-2xl font-semibold mb-4">Aucun résultat trouvé</h3>
        <p className="text-muted-foreground mb-8">
          Essayez d'ajuster vos filtres ou d'essayer une recherche différente.
        </p>
        <Button
          onClick={() => window.history.pushState({}, '', '/search')}
          variant="outline"
        >
          Réinitialiser les filtres
        </Button>
      </div>
    )
  }
  
  return (
    <div>
      <div className="flex justify-between items-center mb-6">
        <p className="text-muted-foreground">
          {pagination.total} outil{pagination.total > 1 ? 's' : ''} trouvé{pagination.total > 1 ? 's' : ''}
        </p>
        <div className="flex items-center space-x-2">
          <Tabs defaultValue={view} className="mr-2">
            <TabsList className="grid w-16 grid-cols-2">
              <TabsTrigger value="grid" className="px-2 py-1">
                <Grid className="h-4 w-4" />
              </TabsTrigger>
              <TabsTrigger value="list" className="px-2 py-1">
                <List className="h-4 w-4" />
              </TabsTrigger>
            </TabsList>
          </Tabs>
          <select
            className="h-9 rounded-md border border-input bg-background px-3 text-sm shadow-sm"
            defaultValue={sort}
            onChange={(e) => {
              const url = new URL(window.location);
              url.searchParams.set('sort', e.target.value);
              window.history.pushState({}, '', url);
            }}
          >
            <option value="relevance">Pertinence</option>
            <option value="rating">Mieux notés</option>
            <option value="newest">Plus récents</option>
            <option value="name">Alphabétique</option>
          </select>
        </div>
      </div>
      
      {view === 'grid' ? (
        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
          {tools.map((tool) => (
            <ToolCard key={tool.id} tool={tool} />
          ))}
        </div>
      ) : (
        <div className="space-y-4">
          {tools.map((tool) => (
            <ToolListItem key={tool.id} tool={tool} />
          ))}
        </div>
      )}
      
      {/* Pagination */}
      {pagination.pages > 1 && (
        <div className="flex justify-center mt-12">
          <div className="flex space-x-1">
            {pageNumber > 1 && (
              <Button
                variant="outline"
                size="sm"
                onClick={() => {
                  const url = new URL(window.location);
                  url.searchParams.set('page', pageNumber - 1);
                  window.history.pushState({}, '', url);
                }}
              >
                Précédent
              </Button>
            )}
            
            {Array.from({ length: Math.min(5, pagination.pages) }, (_, i) => {
              const pageNum = pageNumber <= 3
                ? i + 1
                : pageNumber + i - 2;
                
              if (pageNum <= pagination.pages && pageNum > 0) {
                return (
                  <Button
                    key={pageNum}
                    variant={pageNum === pageNumber ? "default" : "outline"}
                    size="sm"
                    onClick={() => {
                      const url = new URL(window.location);
                      url.searchParams.set('page', pageNum);
                      window.history.pushState({}, '', url);
                    }}
                  >
                    {pageNum}
                  </Button>
                );
              }
              return null;
            })}
            
            {pageNumber < pagination.pages && (
              <Button
                variant="outline"
                size="sm"
                onClick={() => {
                  const url = new URL(window.location);
                  url.searchParams.set('page', pageNumber + 1);
                  window.history.pushState({}, '', url);
                }}
              >
                Suivant
              </Button>
            )}
          </div>
        </div>
      )}
    </div>
  )
}

export default async function SearchPage({ searchParams }) {
  // Extraction des paramètres de recherche
  const {
    q: query = '',
    category: categoryId = null,
    tag: tagIds = [],
    price: pricingType = null,
    sort = 'relevance',
    view = 'grid',
    page = 1
  } = searchParams
  
  // Chargement des données pour les filtres
  const categoriesPromise = getAllCategories()
  const tagsPromise = getAllTags()
  
  const [categories, tags] = await Promise.all([
    categoriesPromise,
    tagsPromise
  ])
  
  // Détermination du titre en fonction des filtres
  let searchTitle = 'Rechercher des outils'
  if (query) {
    searchTitle = `Résultats pour "${query}"`
  } else if (categoryId) {
    const category = categories.find(c => c.id === parseInt(categoryId))
    searchTitle = category ? `Outils de ${category.name}` : 'Rechercher des outils'
  }
  
  // Création d'une liste des filtres appliqués
  const activeFilters = []
  
  if (categoryId) {
    const category = categories.find(c => c.id === parseInt(categoryId))
    if (category) {
      activeFilters.push({
        type: 'category',
        id: category.id,
        label: category.name
      })
    }
  }
  
  if (tagIds) {
    const tagArray = Array.isArray(tagIds) ? tagIds : [tagIds]
    tagArray.forEach(tagId => {
      const tag = tags.find(t => t.id === parseInt(tagId))
      if (tag) {
        activeFilters.push({
          type: 'tag',
          id: tag.id,
          label: tag.name
        })
      }
    })
  }
  
  if (pricingType) {
    const pricingLabels = {
      'free': 'Gratuit',
      'freemium': 'Freemium',
      'paid': 'Payant',
      'trial': 'Essai gratuit'
    }
    activeFilters.push({
      type: 'price',
      id: pricingType,
      label: pricingLabels[pricingType] || pricingType
    })
  }
  
  return (
    <div className="container py-8">
      <div className="grid grid-cols-1 md:grid-cols-[300px_1fr] gap-8">
        {/* Filters sidebar - Desktop only */}
        <div className="hidden md:block">
          <Card className="sticky top-24">
            <CardHeader>
              <CardTitle>Filtres</CardTitle>
              <CardDescription>Affinez votre recherche</CardDescription>
            </CardHeader>
            <CardContent>
              <FilterPanel 
                categories={categories} 
                tags={tags} 
                activeFilters={activeFilters}
              />
            </CardContent>
          </Card>
        </div>
        
        {/* Mobile filters drawer */}
        <div className="md:hidden">
          <FilterDrawer 
            categories={categories} 
            tags={tags} 
            activeFilters={activeFilters}
          />
        </div>
        
        {/* Main content */}
        <div>
          {/* Search header */}
          <div className="mb-8">
            <h1 className="text-3xl font-bold mb-4">{searchTitle}</h1>
            
            {/* Search input */}
            <div className="relative mb-6">
              <SearchIcon className="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground h-4 w-4" />
              <Input
                type="search"
                placeholder="Rechercher un outil..."
                defaultValue={query}
                className="pl-10 w-full"
                onChange={(e) => {
                  // Mise à jour après un court délai pour éviter trop de requêtes
                  const searchTimeout = setTimeout(() => {
                    const url = new URL(window.location);
                    url.searchParams.set('q', e.target.value);
                    window.history.pushState({}, '', url);
                  }, 500);
                  return () => clearTimeout(searchTimeout);
                }}
              />
            </div>
            
            {/* Active filters */}
            {activeFilters.length > 0 && (
              <div className="mb-4">
                <div className="flex flex-wrap gap-2">
                  {activeFilters.map((filter) => (
                    <Badge key={`${filter.type}-${filter.id}`} variant="secondary" className="pr-1">
                      {filter.label}
                      <Button
                        variant="ghost"
                        size="sm"
                        className="h-4 w-4 p-0 ml-1"
                        onClick={() => {
                          const url = new URL(window.location);
                          if (filter.type === 'category') {
                            url.searchParams.delete('category');
                          } else if (filter.type === 'tag') {
                            const currentTags = url.searchParams.getAll('tag');
                            url.searchParams.delete('tag');
                            currentTags
                              .filter(id => parseInt(id) !== filter.id)
                              .forEach(id => url.searchParams.append('tag', id));
                          } else if (filter.type === 'price') {
                            url.searchParams.delete('price');
                          }
                          window.history.pushState({}, '', url);
                        }}
                      >
                        <X className="h-3 w-3" />
                      </Button>
                    </Badge>
                  ))}
                  <Button
                    variant="ghost"
                    size="sm"
                    className="text-xs"
                    onClick={() => {
                      const url = new URL(window.location);
                      url.search = '';
                      if (query) url.searchParams.set('q', query);
                      window.history.pushState({}, '', url);
                    }}
                  >
                    Effacer tous les filtres
                  </Button>
                </div>
              </div>
            )}
            
            <Separator className="my-6" />
          </div>
          
          {/* Search results */}
          <Suspense fallback={<SearchSkeleton view={view} />}>
            <SearchResults 
              query={query}
              categoryId={categoryId}
              tags={tagIds}
              pricingType={pricingType}
              sort={sort}
              view={view}
              page={page}
            />
          </Suspense>
        </div>
      </div>
    </div>
  )
}
```

## 3. Page de soumission d'outil (app/submit/page.js)

```jsx
'use client'

import { useState } from 'react'
import { useRouter } from 'next/navigation'
import { z } from 'zod'
import { useForm } from 'react-hook-form'
import { zodResolver } from '@hookform/resolvers/zod'

import { Button } from '@/components/ui/button'
import { Card, CardContent, CardDescription, CardFooter, CardHeader, CardTitle } from '@/components/ui/card'
import { Input } from '@/components/ui/input'
import { Textarea } from '@/components/ui/textarea'
import { Label } from '@/components/ui/label'
import { RadioGroup, RadioGroupItem } from '@/components/ui/radio-group'
import { Select, SelectContent, SelectItem, SelectTrigger, SelectValue } from '@/components/ui/select'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import { Checkbox } from '@/components/ui/checkbox'
import { Separator } from '@/components/ui/separator'
import { AlertCircle, ChevronRight, ChevronLeft, Upload, Loader2, Check } from 'lucide-react'
import { Alert, AlertDescription, AlertTitle } from '@/components/ui/alert'
import { useCategoriesData, useTagsData } from '@/lib/hooks/useFormData'
import { submitTool } from '@/lib/actions/submissions'
import ImageUploader from '@/components/modules/ImageUploader'

// Schéma de validation
const submissionSchema = z.object({
  // Étape 1 - Informations de base
  name: z.string().min(3, 'Le nom doit contenir au moins 3 caractères').max(100, 'Le nom ne peut pas dépasser 100 caractères'),
  website: z.string().url('Veuillez entrer une URL valide'),
  category_id: z.string().min(1, 'Veuillez sélectionner une catégorie'),
  short_desc: z.string().min(10, 'La description courte doit contenir au moins 10 caractères').max(255, 'La description courte ne peut pas dépasser 255 caractères'),
  
  // Étape 2 - Détails
  description: z.string().min(100, 'La description complète doit contenir au moins 100 caractères'),
  pricing_type: z.enum(['free', 'freemium', 'paid', 'trial'], {
    required_error: 'Veuillez sélectionner un type de tarification'
  }),
  pricing_details: z.string().optional(),
  features: z.array(
    z.object({
      title: z.string().min(3, 'Le titre doit contenir au moins 3 caractères'),
      description: z.string().min(10, 'La description doit contenir au moins 10 caractères')
    })
  ).optional(),
  selected_tags: z.array(z.string()).min(1, 'Veuillez sélectionner au moins un tag'),
  
  // Étape 3 - Médias et contact
  logo: z.any().optional(),
  submitter_name: z.string().min(2, 'Veuillez indiquer votre nom'),
  submitter_email: z.string().email('Veuillez entrer une adresse email valide'),
  terms_accepted: z.boolean().refine(val => val === true, {
    message: 'Vous devez accepter les conditions d\'utilisation'
  })
});

export default function SubmitToolPage() {
  const router = useRouter()
  const [currentStep, setCurrentStep] = useState(1)
  const [isSubmitting, setIsSubmitting] = useState(false)
  const [submissionError, setSubmissionError] = useState(null)
  const [submissionSuccess, setSubmissionSuccess] = useState(false)
  const [logoFile, setLogoFile] = useState(null)
  
  // Chargement des données pour les formulaires
  const { categories, isLoading: isCategoriesLoading } = useCategoriesData()
  const { tags, isLoading: isTagsLoading } = useTagsData()
  
  // Configuration du formulaire avec React Hook Form et Zod
  const { 
    register, 
    handleSubmit, 
    control,
    watch,
    setValue,
    getValues,
    formState: { errors, isValid }
  } = useForm({
    resolver: zodResolver(submissionSchema),
    defaultValues: {
      name: '',
      website: '',
      category_id: '',
      short_desc: '',
      description: '',
      pricing_type: 'paid',
      pricing_details: '',
      features: [{ title: '', description: '' }],
      selected_tags: [],
      submitter_name: '',
      submitter_email: '',
      terms_accepted: false
    },
    mode: 'onChange'
  });
  
  // Suivi des valeurs pour validation conditionnelle
  const watchAllFields = watch()
  
  // Gestion de l'ajout/suppression des features
  const addFeature = () => {
    const features = getValues('features') || []
    setValue('features', [...features, { title: '', description: '' }])
  }
  
  const removeFeature = (index) => {
    const features = getValues('features') || []
    setValue('features', features.filter((_, i) => i !== index))
  }
  
  // Gestion des tags sélectionnés
  const handleTagToggle = (tagId) => {
    const currentTags = getValues('selected_tags') || []
    const tagExists = currentTags.includes(tagId)
    
    setValue(
      'selected_tags',
      tagExists 
        ? currentTags.filter(id => id !== tagId)
        : [...currentTags, tagId],
      { shouldValidate: true }
    )
  }
  
  // Navigation entre les étapes
  const nextStep = () => {
    setCurrentStep(prev => Math.min(prev + 1, 3))
  }
  
  const prevStep = () => {
    setCurrentStep(prev => Math.max(prev - 1, 1))
  }
  
  // Soumission du formulaire
  const onSubmit = async (data) => {
    setIsSubmitting(true)
    setSubmissionError(null)
    
    try {
      // Préparation des données à soumettre
      const formData = new FormData()
      
      // Ajout des champs du formulaire
      Object.entries(data).forEach(([key, value]) => {
        if (key === 'features') {
          formData.append('features', JSON.stringify(value))
        } else if (key === 'selected_tags') {
          formData.append('tags', value.join(','))
        } else if (key !== 'logo' && key !== 'terms_accepted') {
          formData.append(key, value)
        }
      })
      
      // Ajout du logo s'il existe
      if (logoFile) {
        formData.append('logo', logoFile)
      }
      
      // Envoi des données
      const result = await submitTool(formData)
      
      if (result.success) {
        setSubmissionSuccess(true)
        window.scrollTo(0, 0)
      } else {
        setSubmissionError(result.error || 'Une erreur est survenue lors de la soumission. Veuillez réessayer.')
      }
    } catch (error) {
      console.error('Erreur lors de la soumission:', error)
      setSubmissionError('Une erreur inattendue est survenue. Veuillez réessayer.')
    } finally {
      setIsSubmitting(false)
    }
  }
  
  // Vérification de la validité de l'étape courante
  const isStepValid = (step) => {
    switch(step) {
      case 1:
        return (
          !errors.name && 
          !errors.website && 
          !errors.category_id && 
          !errors.short_desc &&
          watchAllFields.name &&
          watchAllFields.website &&
          watchAllFields.category_id &&
          watchAllFields.short_desc
        )
      case 2:
        return (
          !errors.description && 
          !errors.pricing_type && 
          !errors.selected_tags &&
          watchAllFields.description &&
          watchAllFields.pricing_type &&
          watchAllFields.selected_tags?.length > 0
        )
      case 3:
        return (
          !errors.submitter_name && 
          !errors.submitter_email && 
          !errors.terms_accepted &&
          watchAllFields.submitter_name &&
          watchAllFields.submitter_email &&
          watchAllFields.terms_accepted === true
        )
      default:
        return false
    }
  }
  
  // Si la soumission a réussi, afficher le message de succès
  if (submissionSuccess) {
    return (
      <div className="container max-w-4xl py-12">
        <Card className="border-green-500">
          <CardHeader className="bg-green-50 border-b border-green-100">
            <div className="flex items-center">
              <div className="bg-green-100 w-10 h-10 rounded-full flex items-center justify-center mr-4">
                <Check className="h-6 w-6 text-green-600" />
              </div>
              <div>
                <CardTitle className="text-green-700">Soumission réussie !</CardTitle>
                <CardDescription>Votre outil a été soumis avec succès.</CardDescription>
              </div>
            </div>
          </CardHeader>
          <CardContent className="pt-6">
            <p className="mb-6">
              Nous vous remercions pour votre soumission. Notre équipe va examiner votre outil et le publier dans notre annuaire dans les plus brefs délais si celui-ci répond à nos critères.
            </p>
            <p className="mb-6">
              Un email de confirmation a été envoyé à l'adresse <strong>{watchAllFields.submitter_email}</strong>. Vous serez informé par email lorsque votre outil sera publié ou si des informations complémentaires sont nécessaires.
            </p>
            <p className="font-medium">
              Référence de soumission: <span className="font-mono bg-gray-100 py-1 px-2 rounded">{`SUB-${Date.now().toString(36).toUpperCase()}`}</span>
            </p>
          </CardContent>
          <CardFooter className="flex justify-between flex-col sm:flex-row gap-4">
            <Button variant="outline" onClick={() => router.push('/')}>
              Retour à l'accueil
            </Button>
            <Button onClick={() => {
              setSubmissionSuccess(false)
              router.refresh()
            }}>
              Soumettre un autre outil
            </Button>
          </CardFooter>
        </Card>
      </div>
    )
  }
  
  return (
    <div className="container max-w-4xl py-12">
      <div className="mb-8">
        <h1 className="text-3xl font-bold mb-2">Soumettre un outil</h1>
        <p className="text-muted-foreground">
          Vous avez développé un outil d'IA pour la vidéo ? Soumettez-le pour qu'il soit référencé dans notre annuaire.
        </p>
      </div>
      
      {/* Stepper */}
      <div className="mb-8">
        <Tabs value={`step-${currentStep}`} className="w-full">
          <TabsList className="grid grid-cols-3 w-full">
            <TabsTrigger 
              value="step-1" 
              className="data-[state=active]:bg-primary data-[state=active]:text-primary-foreground"
              onClick={() => setCurrentStep(1)}
            >
              Informations de base
            </TabsTrigger>
            <TabsTrigger 
              value="step-2" 
              className="data-[state=active]:bg-primary data-[state=active]:text-primary-foreground"
              onClick={() => isStepValid(1) && setCurrentStep(2)}
            >
              Détails
            </TabsTrigger>
            <TabsTrigger 
              value="step-3" 
              className="data-[state=active]:bg-primary data-[state=active]:text-primary-foreground"
              onClick={() => isStepValid(2) && setCurrentStep(3)}
            >
              Médias et contact
            </TabsTrigger>
          </TabsList>
        </Tabs>
      </div>
      
      {/* Formulaire */}
      <form onSubmit={handleSubmit(onSubmit)}>
        {/* Erreur de soumission */}
        {submissionError && (
          <Alert variant="destructive" className="mb-6">
            <AlertCircle className="h-4 w-4" />
            <AlertTitle>Erreur</AlertTitle>
            <AlertDescription>
              {submissionError}
            </AlertDescription>
          </Alert>
        )}
        
        {/* Étape 1: Informations de base */}
        {currentStep === 1 && (
          <Card>
            <CardHeader>
              <CardTitle>Informations de base</CardTitle>
              <CardDescription>
                Commencez par les informations essentielles de l'outil
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-6">
              {/* Nom de l'outil */}
              <div className="space-y-2">
                <Label htmlFor="name">
                  Nom de l'outil <span className="text-red-500">*</span>
                </Label>
                <Input
                  id="name"
                  placeholder="ex: VideoGen AI"
                  {...register('name')}
                  className={errors.name ? 'border-red-500' : ''}
                />
                {errors.name && (
                  <p className="text-sm text-red-500">{errors.name.message}</p>
                )}
              </div>
              
              {/* URL du site */}
              <div className="space-y-2">
                <Label htmlFor="website">
                  URL du site <span className="text-red-500">*</span>
                </Label>
                <Input
                  id="website"
                  placeholder="ex: https://www.videogenai.com"
                  {...register('website')}
                  className={errors.website ? 'border-red-500' : ''}
                />
                {errors.website && (
                  <p className="text-sm text-red-500">{errors.website.message}</p>
                )}
              </div>
              
              {/* Catégorie */}
              <div className="space-y-2">
                <Label htmlFor="category_id">
                  Catégorie principale <span className="text-red-500">*</span>
                </Label>
                <Select
                  onValueChange={(value) => setValue('category_id', value, { shouldValidate: true })}
                  defaultValue={watchAllFields.category_id}
                >
                  <SelectTrigger 
                    id="category_id"
                    className={errors.category_id ? 'border-red-500' : ''}
                  >
                    <SelectValue placeholder="Sélectionnez une catégorie" />
                  </SelectTrigger>
                  <SelectContent>
                    {isCategoriesLoading ? (
                      <div className="p-2 text-center">Chargement...</div>
                    ) : (
                      categories.map((category) => (
                        <SelectItem key={category.id} value={category.id.toString()}>
                          {category.name}
                        </SelectItem>
                      ))
                    )}
                  </SelectContent>
                </Select>
                {errors.category_id && (
                  <p className="text-sm text-red-500">{errors.category_id.message}</p>
                )}
              </div>
              
              {/* Description courte */}
              <div className="space-y-2">
                <Label htmlFor="short_desc">
                  Description courte <span className="text-red-500">*</span>
                </Label>
                <Textarea
                  id="short_desc"
                  placeholder="Décrivez brièvement votre outil en une phrase"
                  {...register('short_desc')}
                  className={errors.short_desc ? 'border-red-500' : ''}
                  rows={3}
                />
                <div className="flex justify-between text-xs">
                  <span className={errors.short_desc ? 'text-red-500' : 'text-muted-foreground'}>
                    {errors.short_desc ? errors.short_desc.message : 'Maximum 255 caractères'}
                  </span>
                  <span className="text-muted-foreground">
                    {watchAllFields.short_desc?.length || 0}/255
                  </span>
                </div>
              </div>
            </CardContent>
            <CardFooter className="justify-between border-t p-4">
              <div></div>
              <Button
                type="button"
                onClick={nextStep}
                disabled={!isStepValid(1)}
              >
                Suivant
                <ChevronRight className="ml-2 h-4 w-4" />
              </Button>
            </CardFooter>
          </Card>
        )}
        
        {/* Étape 2: Détails */}
        {currentStep === 2 && (
          <Card>
            <CardHeader>
              <CardTitle>Détails</CardTitle>
              <CardDescription>
                Ajoutez plus d'informations sur votre outil
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-6">
              {/* Description complète */}
              <div className="space-y-2">
                <Label htmlFor="description">
                  Description complète <span className="text-red-500">*</span>
                </Label>
                <Textarea
                  id="description"
                  placeholder="Décrivez votre outil en détail, ses fonctionnalités, ses avantages..."
                  {...register('description')}
                  className={errors.description ? 'border-red-500' : ''}
                  rows={8}
                />
                {errors.description && (
                  <p className="text-sm text-red-500">{errors.description.message}</p>
                )}
                <p className="text-xs text-muted-foreground">
                  Le formatage Markdown est supporté
                </p>
              </div>
              
              {/* Type de tarification */}
              <div className="space-y-2">
                <Label>
                  Type de tarification <span className="text-red-500">*</span>
                </Label>
                <RadioGroup 
                  defaultValue={watchAllFields.pricing_type}
                  onValueChange={(value) => setValue('pricing_type', value, { shouldValidate: true })}
                >
                  <div className="flex items-center space-x-2">
                    <RadioGroupItem value="free" id="pricing-free" />
                    <Label htmlFor="pricing-free">Gratuit</Label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <RadioGroupItem value="freemium" id="pricing-freemium" />
                    <Label htmlFor="pricing-freemium">Freemium</Label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <RadioGroupItem value="paid" id="pricing-paid" />
                    <Label htmlFor="pricing-paid">Payant</Label>
                  </div>
                  <div className="flex items-center space-x-2">
                    <RadioGroupItem value="trial" id="pricing-trial" />
                    <Label htmlFor="pricing-trial">Essai gratuit</Label>
                  </div>
                </RadioGroup>
                {errors.pricing_type && (
                  <p className="text-sm text-red-500">{errors.pricing_type.message}</p>
                )}
              </div>
              
              {/* Détails de tarification */}
              <div className="space-y-2">
                <Label htmlFor="pricing_details">
                  Détails de tarification
                </Label>
                <Textarea
                  id="pricing_details"
                  placeholder="Détaillez les options de tarification, les plans, etc."
                  {...register('pricing_details')}
                  rows={4}
                />
              </div>
              
              {/* Fonctionnalités principales */}
              <div className="space-y-2">
                <Label>Fonctionnalités principales</Label>
                <div className="space-y-4">
                  {watchAllFields.features?.map((feature, index) => (
                    <div key={index} className="space-y-2 p-4 border rounded-md">
                      <div className="flex justify-between items-center">
                        <Label htmlFor={`features.${index}.title`}>Titre</Label>
                        {index > 0 && (
                          <Button 
                            type="button" 
                            variant="ghost" 
                            size="sm"
                            onClick={() => removeFeature(index)}
                          >
                            Supprimer
                          </Button>
                        )}
                      </div>
                      <Input
                        id={`features.${index}.title`}
                        placeholder="ex: Génération automatique"
                        {...register(`features.${index}.title`)}
                      />
                      
                      <Label htmlFor={`features.${index}.description`}>Description</Label>
                      <Textarea
                        id={`features.${index}.description`}
                        placeholder="ex: Créez des vidéos à partir d'un simple texte"
                        {...register(`features.${index}.description`)}
                        rows={2}
                      />
                    </div>
                  ))}
                  
                  <Button 
                    type="button" 
                    variant="outline" 
                    onClick={addFeature}
                    className="w-full"
                  >
                    Ajouter une fonctionnalité
                  </Button>
                </div>
              </div>
              
              {/* Tags */}
              <div className="space-y-2">
                <Label>
                  Tags <span className="text-red-500">*</span>
                </Label>
                <div className="grid grid-cols-2 sm:grid-cols-3 gap-2 border rounded-md p-4">
                  {isTagsLoading ? (
                    <div className="col-span-full text-center py-4">Chargement...</div>
                  ) : (
                    tags.map((tag) => (
                      <div key={tag.id} className="flex items-center space-x-2">
                        <Checkbox
                          id={`tag-${tag.id}`}
                          checked={watchAllFields.selected_tags?.includes(tag.id.toString())}
                          onCheckedChange={() => handleTagToggle(tag.id.toString())}
                        />
                        <label
                          htmlFor={`tag-${tag.id}`}
                          className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
                        >
                          {tag.name}
                        </label>
                      </div>
                    ))
                  )}
                </div>
                {errors.selected_tags && (
                  <p className="text-sm text-red-500">{errors.selected_tags.message}</p>
                )}
              </div>
            </CardContent>
            <CardFooter className="justify-between border-t p-4">
              <Button
                type="button"
                variant="outline"
                onClick={prevStep}
              >
                <ChevronLeft className="mr-2 h-4 w-4" />
                Précédent
              </Button>
              <Button
                type="button"
                onClick={nextStep}
                disabled={!isStepValid(2)}
              >
                Suivant
                <ChevronRight className="ml-2 h-4 w-4" />
              </Button>
            </CardFooter>
          </Card>
        )}
        
        {/* Étape 3: Médias et contact */}
        {currentStep === 3 && (
          <Card>
            <CardHeader>
              <CardTitle>Médias et contact</CardTitle>
              <CardDescription>
                Finalisez votre soumission avec logo et informations de contact
              </CardDescription>
            </CardHeader>
            <CardContent className="space-y-6">
              {/* Upload de logo */}
              <div className="space-y-2">
                <Label>Logo de l'outil</Label>
                <ImageUploader
                  onImageSelected={(file) => setLogoFile(file)}
                />
                <p className="text-xs text-muted-foreground">
                  Format recommandé: JPG ou PNG, carré, min. 400x400px
                </p>
              </div>
              
              <Separator />
              
              {/* Informations de contact */}
              <div className="space-y-2">
                <Label htmlFor="submitter_name">
                  Votre nom <span className="text-red-500">*</span>
                </Label>
                <Input
                  id="submitter_name"
                  placeholder="ex: Marie Dupont"
                  {...register('submitter_name')}
                  className={errors.submitter_name ? 'border-red-500' : ''}
                />
                {errors.submitter_name && (
                  <p className="text-sm text-red-500">{errors.submitter_name.message}</p>
                )}
              </div>
              
              <div className="space-y-2">
                <Label htmlFor="submitter_email">
                  Votre email <span className="text-red-500">*</span>
                </Label>
                <Input
                  id="submitter_email"
                  type="email"
                  placeholder="ex: marie@example.com"
                  {...register('submitter_email')}
                  className={errors.submitter_email ? 'border-red-500' : ''}
                />
                {errors.submitter_email && (
                  <p className="text-sm text-red-500">{errors.submitter_email.message}</p>
                )}
                <p className="text-xs text-muted-foreground">
                  Nous vous contacterons à cette adresse pour vous informer de l'état de votre soumission
                </p>
              </div>
              
              {/* Conditions d'utilisation */}
              <div className="space-y-2">
                <div className="flex items-center space-x-2">
                  <Checkbox
                    id="terms_accepted"
                    checked={watchAllFields.terms_accepted}
                    onCheckedChange={(checked) => 
                      setValue('terms_accepted', checked, { shouldValidate: true })
                    }
                  />
                  <label
                    htmlFor="terms_accepted"
                    className="text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"
                  >
                    J'accepte les <a href="/terms" className="text-primary underline" target="_blank">conditions d'utilisation</a> et je confirme que je dispose des droits nécessaires pour soumettre cet outil.
                  </label>
                </div>
                {errors.terms_accepted && (
                  <p className="text-sm text-red-500">{errors.terms_accepted.message}</p>
                )}
              </div>
            </CardContent>
            <CardFooter className="justify-between border-t p-4">
              <Button
                type="button"
                variant="outline"
                onClick={prevStep}
              >
                <ChevronLeft className="mr-2 h-4 w-4" />
                Précédent
              </Button>
              <Button
                type="submit"
                disabled={isSubmitting || !isStepValid(3)}
              >
                {isSubmitting ? (
                  <>
                    <Loader2 className="mr-2 h-4 w-4 animate-spin" />
                    Soumission en cours...
                  </>
                ) : (
                  <>
                    Soumettre l'outil
                  </>
                )}
              </Button>
            </CardFooter>
          </Card>
        )}
      </form>
    </div>
  )
}
```

## 4. Mise en page Admin (app/admin/layout.js)

```jsx
'use client'

import { useState, useEffect } from 'react'
import { useRouter, usePathname } from 'next/navigation'
import Link from 'next/link'
import { useSession, signIn } from 'next-auth/react'
import { 
  LayoutDashboard, 
  Boxes, 
  Tag, 
  MessageSquare, 
  Users, 
  FileText, 
  Settings, 
  Menu, 
  X,
  LogOut
} from 'lucide-react'

import { Button } from '@/components/ui/button'
import { Toaster } from '@/components/ui/toaster'
import { ScrollArea } from '@/components/ui/scroll-area'
import { Skeleton } from '@/components/ui/skeleton'
import AdminHeader from '@/components/layout/AdminHeader'

// Structure du menu admin
const menuItems = [
  {
    title: 'Tableau de bord',
    icon: <LayoutDashboard className="h-5 w-5" />,
    href: '/admin',
  },
  {
    title: 'Outils',
    icon: <Boxes className="h-5 w-5" />,
    href: '/admin/tools',
  },
  {
    title: 'Catégories',
    icon: <Tag className="h-5 w-5" />,
    href: '/admin/categories',
  },
  {
    title: 'Avis',
    icon: <MessageSquare className="h-5 w-5" />,
    href: '/admin/reviews',
  },
  {
    title: 'Soumissions',
    icon: <FileText className="h-5 w-5" />,
    href: '/admin/submissions',
  },
  {
    title: 'Utilisateurs',
    icon: <Users className="h-5 w-5" />,
    href: '/admin/users',
  },
  {
    title: 'Paramètres',
    icon: <Settings className="h-5 w-5" />,
    href: '/admin/settings',
  },
];

export default function AdminLayout({ children }) {
  const pathname = usePathname()
  const router = useRouter()
  const { data: session, status } = useSession()
  const [sidebarOpen, setSidebarOpen] = useState(false)
  
  // Redirection vers la page de connexion si non authentifié
  useEffect(() => {
    if (status === 'unauthenticated') {
      router.push('/admin/login')
    }
  }, [status, router])
  
  // Affichage d'un écran de chargement pendant la vérification de l'authentification
  if (status === 'loading') {
    return <AdminLoadingSkeleton />
  }
  
  // Redirection si non authentifié
  if (status === 'unauthenticated') {
    return null
  }
  
  return (
    <div className="min-h-screen bg-gray-50 dark:bg-gray-900">
      {/* Mobile sidebar backdrop */}
      {sidebarOpen && (
        <div 
          className="fixed inset-0 z-40 bg-black/50 lg:hidden"
          onClick={() => setSidebarOpen(false)}
        />
      )}
      
      {/* Sidebar */}
      <aside 
        className={`fixed top-0 left-0 z-50 w-64 h-full bg-white dark:bg-gray-800 shadow-lg transform transition-transform lg:translate-x-0 ${
          sidebarOpen ? 'translate-x-0' : '-translate-x-full'
        }`}
      >
        <div className="flex flex-col h-full">
          {/* Sidebar header */}
          <div className="p-4 border-b flex items-center justify-between">
            <Link href="/admin" className="flex items-center gap-2">
              <div className="bg-primary h-8 w-8 rounded-md flex items-center justify-center">
                <span className="text-white font-bold">VI</span>
              </div>
              <span className="font-bold text-lg">Video-IA Admin</span>
            </Link>
            <Button 
              variant="ghost" 
              size="icon" 
              className="lg:hidden"
              onClick={() => setSidebarOpen(false)}
            >
              <X className="h-5 w-5" />
            </Button>
          </div>
          
          {/* Sidebar navigation */}
          <ScrollArea className="flex-1 py-4">
            <nav className="px-2 space-y-1">
              {menuItems.map(item => (
                <Link
                  key={item.href}
                  href={item.href}
                  className={`flex items-center gap-3 px-3 py-2 rounded-md text-sm font-medium ${
                    pathname === item.href
                      ? 'bg-primary/10 text-primary dark:bg-primary/20'
                      : 'text-gray-700 hover:bg-gray-100 dark:text-gray-300 dark:hover:bg-gray-700'
                  }`}
                >
                  {item.icon}
                  {item.title}
                </Link>
              ))}
            </nav>
          </ScrollArea>
          
          {/* Sidebar footer */}
          <div className="p-4 border-t">
            <div className="flex items-center justify-between">
              <div className="flex items-center gap-2">
                <div className="h-8 w-8 rounded-full bg-gray-200 flex items-center justify-center">
                  <span className="font-medium text-sm">
                    {session?.user?.name?.charAt(0) || 'A'}
                  </span>
                </div>
                <div className="text-sm">
                  <p className="font-medium">{session?.user?.name || 'Admin'}</p>
                  <p className="text-xs text-gray-500">{session?.user?.email}</p>
                </div>
              </div>
              <Button
                variant="ghost"
                size="icon"
                onClick={() => signOut({ callbackUrl: '/admin/login' })}
              >
                <LogOut className="h-4 w-4" />
              </Button>
            </div>
          </div>
        </div>
      </aside>
      
      {/* Main content */}
      <div className="lg:pl-64">
        {/* Header */}
        <AdminHeader 
          onMenuClick={() => setSidebarOpen(true)}
          user={session?.user}
        />
        
        {/* Page content */}
        <main className="p-4 md:p-6 max-w-7xl mx-auto">
          {children}
        </main>
      </div>
      
      <Toaster />
    </div>
  )
}

// Squelette de chargement pour l'interface admin
function AdminLoadingSkeleton() {
  return (
    <div className="min-h-screen bg-gray-50">
      <div className="lg:pl-64">
        <header className="h-16 bg-white shadow-sm flex items-center justify-between px-4">
          <Skeleton className="h-10 w-10" />
          <div className="flex items-center gap-4">
            <Skeleton className="h-8 w-24" />
            <Skeleton className="h-8 w-8 rounded-full" />
          </div>
        </header>
        
        <main className="p-6 max-w-7xl mx-auto">
          <Skeleton className="h-10 w-1/3 mb-6" />
          <div className="grid gap-6">
            <Skeleton className="h-64 w-full rounded-lg" />
            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
              <Skeleton className="h-40 w-full rounded-lg" />
              <Skeleton className="h-40 w-full rounded-lg" />
              <Skeleton className="h-40 w-full rounded-lg" />
            </div>
          </div>
        </main>
      </div>
    </div>
  )
}
```

## 5. Page d'administration des outils (app/admin/tools/page.js)

```jsx
'use client'

import { useState, useEffect } from 'react'
import Link from 'next/link'
import { useRouter, useSearchParams } from 'next/navigation'
import { useToast } from '@/components/ui/use-toast'
import { Button } from '@/components/ui/button'
import { Input } from '@/components/ui/input'
import { Tabs, TabsContent, TabsList, TabsTrigger } from '@/components/ui/tabs'
import {
  Card,
  CardContent,
  CardDescription,
  CardHeader,
  CardTitle,
} from '@/components/ui/card'
import {
  Table,
  TableBody,
  TableCell,
  TableHead,
  TableHeader,
  TableRow,
} from '@/components/ui/table'
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuTrigger,
} from '@/components/ui/dropdown-menu'
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogFooter,
  DialogHeader,
  DialogTitle,
  DialogTrigger,
} from '@/components/ui/dialog'
import { Badge } from '@/components/ui/badge'
import { Checkbox } from '@/components/ui/checkbox'
import { 
  Search, 
  Plus, 
  MoreVertical, 
  Edit, 
  Trash2, 
  ExternalLink,
  Star,
  ArrowUpDown
} from 'lucide-react'
import { getAdminTools, deleteTool, toggleFeaturedTool } from '@/lib/actions/admin'
import { formatDate } from '@/lib/utils/formatting'

export default function AdminToolsPage() {
  const router = useRouter()
  const searchParams = useSearchParams()
  const { toast } = useToast()
  
  // État local pour la gestion des tools
  const [tools, setTools] = useState([])
  const [featuredTools, setFeaturedTools] = useState([])
  const [isLoading, setIsLoading] = useState(true)
  const [searchQuery, setSearchQuery] = useState('')
  const [selectedTools, setSelectedTools] = useState([])
  const [deleteDialogOpen, setDeleteDialogOpen] = useState(false)
  const [toolToDelete, setToolToDelete] = useState(null)
  const [sortField, setSortField] = useState('created_at')
  const [sortDirection, setSortDirection] = useState('desc')
  
  // Filtres de l'URL
  const category = searchParams.get('category')
  const status = searchParams.get('status')
  
  // Chargement des données
  useEffect(() => {
    const loadTools = async () => {
      setIsLoading(true)
      try {
        const data = await getAdminTools({
          category,
          status,
          search: searchQuery,
          sort: sortField,
          order: sortDirection,
        })
        
        setTools(data.tools)
        setFeaturedTools(data.tools.filter(tool => tool.is_featured))
      } catch (error) {
        console.error('Erreur lors du chargement des outils:', error)
        toast({
          title: 'Erreur',
          description: 'Impossible de charger les outils. Veuillez réessayer.',
          variant: 'destructive',
        })
      } finally {
        setIsLoading(false)
      }
    }
    
    loadTools()
  }, [category, status, searchQuery, sortField, sortDirection, toast])
  
  // Gestion du tri
  const handleSort = (field) => {
    if (field === sortField) {
      setSortDirection(sortDirection === 'asc' ? 'desc' : 'asc')
    } else {
      setSortField(field)
      setSortDirection('asc')
    }
  }
  
  // Gestion de la sélection
  const handleSelectAll = (checked) => {
    if (checked) {
      setSelectedTools(tools.map(tool => tool.id))
    } else {
      setSelectedTools([])
    }
  }
  
  const handleSelectTool = (checked, toolId) => {
    if (checked) {
      setSelectedTools(prev => [...prev, toolId])
    } else {
      setSelectedTools(prev => prev.filter(id => id !== toolId))
    }
  }
  
  // Gestion de la suppression
  const handleDeleteClick = (tool) => {
    setToolToDelete(tool)
    setDeleteDialogOpen(true)
  }
  
  const handleDeleteConfirm = async () => {
    if (!toolToDelete) return
    
    try {
      const result = await deleteTool(toolToDelete.id)
      
      if (result.success) {
        setTools(tools.filter(t => t.id !== toolToDelete.id))
        toast({
          title: 'Outil supprimé',
          description: `L'outil "${toolToDelete.name}" a été supprimé avec succès.`,
        })
      } else {
        throw new Error(result.error)
      }
    } catch (error) {
      toast({
        title: 'Erreur',
        description: error.message || 'Une erreur est survenue lors de la suppression.',
        variant: 'destructive',
      })
    } finally {
      setDeleteDialogOpen(false)
      setToolToDelete(null)
    }
  }
  
  // Gestion du featured
  const handleToggleFeatured = async (tool) => {
    try {
      const result = await toggleFeaturedTool(tool.id, !tool.is_featured)
      
      if (result.success) {
        // Mise à jour locale de l'état
        setTools(tools.map(t => 
          t.id === tool.id ? { ...t, is_featured: !t.is_featured } : t
        ))
        
        // Mise à jour de la liste des outils featured
        if (!tool.is_featured) {
          setFeaturedTools(prev => [...prev, { ...tool, is_featured: true }])
        } else {
          setFeaturedTools(prev => prev.filter(t => t.id !== tool.id))
        }
        
        toast({
          title: tool.is_featured ? 'Outil retiré des vedettes' : 'Outil mis en vedette',
          description: `L'outil "${tool.name}" a été ${tool.is_featured ? 'retiré des' : 'ajouté aux'} outils vedettes.`,
        })
      } else {
        throw new Error(result.error)
      }
    } catch (error) {
      toast({
        title: 'Erreur',
        description: error.message || 'Une erreur est survenue.',
        variant: 'destructive',
      })
    }
  }
  
  // Génération du tableau des outils
  const renderToolsTable = (toolsList) => (
    <div className="rounded-md border">
      <Table>
        <TableHeader>
          <TableRow>
            <TableHead className="w-12">
              <Checkbox 
                checked={selectedTools.length === toolsList.length && toolsList.length > 0}
                onCheckedChange={handleSelectAll}
                aria-label="Select all"
              />
            </TableHead>
            <TableHead>
              <div 
                className="flex items-center cursor-pointer"
                onClick={() => handleSort('name')}
              >
                Nom
                <ArrowUpDown className="ml-2 h-4 w-4" />
              </div>
            </TableHead>
            <TableHead>Catégorie</TableHead>
            <TableHead>
              <div 
                className="flex items-center cursor-pointer"
                onClick={() => handleSort('created_at')}
              >
                Date d'ajout
                <ArrowUpDown className="ml-2 h-4 w-4" />
              </div>
            </TableHead>
            <TableHead>
              <div 
                className="flex items-center cursor-pointer"
                onClick={() => handleSort('rating')}
              >
                Note
                <ArrowUpDown className="ml-2 h-4 w-4" />
              </div>
            </TableHead>
            <TableHead>Prix</TableHead>
            <TableHead>Statut</TableHead>
            <TableHead className="w-24">Actions</TableHead>
          </TableRow>
        </TableHeader>
        <TableBody>
          {isLoading ? (
            Array.from({ length: 5 }).map((_, i) => (
              <TableRow key={i} className="animate-pulse">
                <TableCell><div className="h-4 w-4 bg-gray-200 rounded"></div></TableCell>
                <TableCell><div className="h-4 w-32 bg-gray-200 rounded"></div></TableCell>
                <TableCell><div className="h-4 w-24 bg-gray-200 rounded"></div></TableCell>
                <TableCell><div className="h-4 w-20 bg-gray-200 rounded"></div></TableCell>
                <TableCell><div className="h-4 w-16 bg-gray-200 rounded"></div></TableCell>
                <TableCell><div className="h-4 w-16 bg-gray-200 rounded"></div></TableCell>
                <TableCell><div className="h-4 w-16 bg-gray-200 rounded"></div></TableCell>
                <TableCell><div className="h-8 w-8 bg-gray-200 rounded"></div></TableCell>
              </TableRow>
            ))
          ) : toolsList.length === 0 ? (
            <TableRow>
              <TableCell colSpan={8} className="text-center py-6 text-muted-foreground">
                Aucun outil trouvé
              </TableCell>
            </TableRow>
          ) : (
            toolsList.map((tool) => (
              <TableRow key={tool.id}>
                <TableCell>
                  <Checkbox 
                    checked={selectedTools.includes(tool.id)}
                    onCheckedChange={(checked) => handleSelectTool(checked, tool.id)}
                    aria-label={`Select ${tool.name}`}
                  />
                </TableCell>
                <TableCell>
                  <div className="font-medium max-w-xs truncate">
                    {tool.name}
                    {tool.is_featured && (
                      <Star className="inline ml-1 h-3 w-3 text-yellow-500" />
                    )}
                  </div>
                </TableCell>
                <TableCell>
                  <Badge variant="outline">
                    {tool.category?.name || 'Non catégorisé'}
                  </Badge>
                </TableCell>
                <TableCell>
                  {formatDate(tool.created_at)}
                </TableCell>
                <TableCell>
                  <div className="flex items-center">
                    <Star className="h-4 w-4 text-yellow-500 mr-1" />
                    <span>{tool.rating ? tool.rating.toFixed(1) : 'N/A'}</span>
                    <span className="text-xs text-muted-foreground ml-1">
                      ({tool.reviews_count || 0})
                    </span>
                  </div>
                </TableCell>
                <TableCell>
                  <Badge variant={
                    tool.pricing_type === 'free' ? 'success' : 
                    tool.pricing_type === 'freemium' ? 'warning' : 
                    'default'
                  }>
                    {tool.pricing_type === 'free' ? 'Gratuit' : 
                     tool.pricing_type === 'freemium' ? 'Freemium' : 
                     tool.pricing_type === 'trial' ? 'Essai' : 'Payant'}
                  </Badge>
                </TableCell>
                <TableCell>
                  <Badge variant={tool.view_count > 0 ? 'outline' : 'secondary'}>
                    {tool.view_count > 0 ? 'Actif' : 'Nouveau'}
                  </Badge>
                </TableCell>
                <TableCell>
                  <DropdownMenu>
                    <DropdownMenuTrigger asChild>
                      <Button variant="ghost" className="h-8 w-8 p-0">
                        <MoreVertical className="h-4 w-4" />
                      </Button>
                    </DropdownMenuTrigger>
                    <DropdownMenuContent align="end">
                      <DropdownMenuItem asChild>
                        <Link href={`/tools/${tool.slug}`} target="_blank">
                          <ExternalLink className="mr-2 h-4 w-4" />
                          Voir
                        </Link>
                      </DropdownMenuItem>
                      <DropdownMenuItem asChild>
                        <Link href={`/admin/tools/edit/${tool.id}`}>
                          <Edit className="mr-2 h-4 w-4" />
                          Modifier
                        </Link>
                      </DropdownMenuItem>
                      <DropdownMenuItem 
                        onClick={() => handleToggleFeatured(tool)}
                      >
                        <Star className="mr-2 h-4 w-4" />
                        {tool.is_featured ? 'Retirer des vedettes' : 'Mettre en vedette'}
                      </DropdownMenuItem>
                      <DropdownMenuItem 
                        onClick={() => handleDeleteClick(tool)}
                        className="text-red-600"
                      >
                        <Trash2 className="mr-2 h-4 w-4" />
                        Supprimer
                      </DropdownMenuItem>
                    </DropdownMenuContent>
                  </DropdownMenu>
                </TableCell>
              </TableRow>
            ))
          )}
        </TableBody>
      </Table>
    </div>
  )
  
  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h1 className="text-3xl font-bold">Outils</h1>
        <Button asChild>
          <Link href="/admin/tools/new">
            <Plus className="mr-2 h-4 w-4" />
            Ajouter un outil
          </Link>
        </Button>
      </div>
      
      <Card>
        <CardHeader className="pb-3">
          <CardTitle>Gérer les outils</CardTitle>
          <CardDescription>
            Consultez, modifiez ou supprimez les outils de la plateforme
          </CardDescription>
        </CardHeader>
        <CardContent>
          <div className="flex flex-col md:flex-row gap-4 mb-6">
            <div className="flex-1 relative">
              <Search className="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground h-4 w-4" />
              <Input
                placeholder="Rechercher un outil..."
                className="pl-10"
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
              />
            </div>
            
            <div className="flex gap-2">
              <Button 
                variant="outline" 
                className="w-full md:w-auto"
                disabled={selectedTools.length === 0}
              >
                Actions groupées
              </Button>
            </div>
          </div>
          
          <Tabs defaultValue="all">
            <TabsList className="mb-4">
              <TabsTrigger value="all">Tous ({tools.length})</TabsTrigger>
              <TabsTrigger value="featured">Vedettes ({featuredTools.length})</TabsTrigger>
            </TabsList>
            
            <TabsContent value="all">
              {renderToolsTable(tools)}
            </TabsContent>
            
            <TabsContent value="featured">
              {renderToolsTable(featuredTools)}
            </TabsContent>
          </Tabs>
        </CardContent>
      </Card>
      
      {/* Confirmation Dialog for Delete */}
      <Dialog open={deleteDialogOpen} onOpenChange={setDeleteDialogOpen}>
        <DialogContent>
          <DialogHeader>
            <DialogTitle>Confirmer la suppression</DialogTitle>
            <DialogDescription>
              Êtes-vous sûr de vouloir supprimer l'outil "{toolToDelete?.name}" ? Cette action est irréversible.
            </DialogDescription>
          </DialogHeader>
          <DialogFooter>
            <Button 
              variant="outline" 
              onClick={() => setDeleteDialogOpen(false)}
            >
              Annuler
            </Button>
            <Button 
              variant="destructive" 
              onClick={handleDeleteConfirm}
            >
              Supprimer
            </Button>
          </DialogFooter>
        </DialogContent>
      </Dialog>
    </div>
  )
}
```

Ces implémentations de pages montrent l'utilisation complète de Next.js avec Shadcn UI et Tailwind CSS dans le projet Video-IA. Vous pouvez voir comment les composants partagés sont utilisés de manière cohérente à travers l'application, comment les données sont récupérées et affichées, et comment les différentes fonctionnalités sont implémentées pour une expérience utilisateur fluide et professionnelle.